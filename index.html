<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client-side Hash Calculator</title>
    <script>
    function sha256buffer(buffer) {
      return crypto.subtle.digest("SHA-256", buffer);
    };

    // From https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest
    function hex(buffer) {
      var hexCodes = [];
      var view = new DataView(buffer);
      for (var i = 0; i < view.byteLength; i += 4) {
        // Using getUint32 reduces the number of iterations needed (we process 4 bytes each time)
        var value = view.getUint32(i)
        // toString(16) will give the hex representation of the number without padding
        var stringValue = value.toString(16)
        // We use concatenation and slice for padding
        var padding = '00000000'
        var paddedValue = (padding + stringValue).slice(-padding.length)
        hexCodes.push(paddedValue);
      }
      return hexCodes.join("");
    };

    // Print the hash of a local file
    window.addEventListener("load", function () {
      document.getElementById('fileinput').addEventListener('change', function(){
        var file = this.files[0];

        var fileReader = new FileReader();
        fileReader.onload = function() {
          sha256buffer(this.result)
          .then(function(hashArray) {
            var sha256 = hex(hashArray);
            document.getElementById('sha256-hash').innerText = sha256;
          }).catch(function(err) {
            console.log(err)
          });   
        };

        fileReader.readAsArrayBuffer(file);
      });
    });
     
    </script>
  </head>
  <body>
    <input type="file" id="fileinput" />
    <div id="sha256-hash"></div>
  </body>
</html>
