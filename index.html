<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHA-256 Hash Calculator</title>
    <style>
      html {
        box-sizing: border-box;
        font-family: -apple-system, BlinkMacSystemFont,
            "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell",
            "Fira Sans", "Droid Sans", "Helvetica Neue",
            sans-serif;
      }
      *, *:before, *:after {
        box-sizing: inherit;
      }
      body {
        padding-right: 15%;
        padding-left: 15%;
      }
      h1, h2 {
        margin: 0.8em 0 0.2em 0;
      }
      p {
        font-size: 18px;
        margin: 0.2em 0 0.2em 0;
      }
      #uri {
          width: 450px;
          margin: 0.8em 0 0.2em 0;
      }
      #drop-area {
        width: 96%;
        margin: 1% 2% 1% 2%;
        border: solid #000 1px;
        padding: 2em;
        text-align: center;
        font-size: 20px;
      }
      #fileinput {
          margin-left: 75%;
      }
      [data-tooltip] {
        border-bottom: 1px dotted #000;
        color: #000;
        outline: none;
        cursor: help;
        text-decoration: none;
        position: relative;
      }
      [data-tooltip]:after {
        -webkit-transition: .2s;
        transition: .2s;
        opacity: 0;
        visibility: hidden;
        top: 2em;
        display: block;
        position: absolute;
      }
      [data-tooltip]:after {
        width: 350px;
        padding: 10px;
        left: 0px;
        margin-bottom: 15px;
        background: #FFF;
        border: 1px solid #000;
        border-radius: 3px;
        text-align: center;
        content: attr(data-tooltip);
      }
      [data-tooltip]:hover:after {
        opacity: 1;
        visibility: visible;
        margin-bottom: 12px;
      }
    </style>
    <script>
    function sha256buffer(buffer) {
      return crypto.subtle.digest("SHA-256", buffer);
    };

    // From https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest
    function hex(buffer) {
      var hexCodes = [];
      var view = new DataView(buffer);
      for (var i = 0; i < view.byteLength; i += 4) {
        // Using getUint32 reduces the number of iterations needed (we process 4 bytes each time)
        var value = view.getUint32(i)
        // toString(16) will give the hex representation of the number without padding
        var stringValue = value.toString(16)
        // We use concatenation and slice for padding
        var padding = '00000000'
        var paddedValue = (padding + stringValue).slice(-padding.length)
        hexCodes.push(paddedValue);
      }
      return hexCodes.join("");
    };

    function getRemoteResource(uri, success, error) {
      var xhr = new XMLHttpRequest();
      xhr.responseType = 'arraybuffer';
      xhr.addEventListener('load', function(event) {
        success(this.response);
      });
      xhr.addEventListener('error', error);
      xhr.open('GET', uri);
      xhr.send();
    };

    function hashSuccess(hashArray) {
      var sha256 = hex(hashArray);
      document.getElementById('sha256-hash').innerHTML =
        '<h2>SHA-256 Hash</h2><p>' + sha256;
    };

    function hashError(err) {
      document.getElementById('errors').innerText = 'Error hashing file';
    };

    function hashFile(file) {
        var fileReader = new FileReader();
        fileReader.onload = function() {
          sha256buffer(this.result)
          .then(hashSuccess)
          .catch(hashError)
        };
        fileReader.readAsArrayBuffer(file);
    };

    // Print the hash of a local file
    window.addEventListener("load", function () {
      document.getElementById('fileinput').addEventListener('change', function(){
        var file = this.files[0];
        hashFile(file);
      });

      // Fetch the remote resource upon submit
      var form = document.getElementById('uri-form');

      form.addEventListener("submit", function (event) {
        event.preventDefault();
        var uri = document.getElementById('uri').value;

        var getSuccess = function(buffer) {
          sha256buffer(buffer)
          .then(hashSuccess)
          .catch(hashError)
        };
        var getError = function() {
          document.getElementById('errors').innerText =
            'Problem fetching ' + uri + '. If this URL is valid, the remote '
            + 'server probably does not allow cross-domain requests.';
        };
        getRemoteResource(uri, getSuccess, getError);
      });

      var dropArea = document.getElementById('drop-area');
      dropArea.addEventListener('dragover', function(evt) {
        evt.preventDefault();
        evt.dataTransfer.dropEffect = 'copy';
      });
      dropArea.addEventListener('drop', function(evt) {
        evt.preventDefault();
        var file = evt.dataTransfer.files[0];
        hashFile(file);
      });
      dropArea.addEventListener('click', function(evt) {
        evt.preventDefault();
        var fileinput = document.getElementById('fileinput');
        var doc = fileinput.ownerDocument;
        var fileinputClick = doc.createEvent("MouseEvents");
        fileinputClick.initEvent('click', true, true);
        fileinput.dispatchEvent(fileinputClick, true);
      });
     
    });
    </script>
  </head>
  <body>
    <h1>SHA-256 Hash Calculator</h1>
    <p>This tool computes SHA-256 hashes directly in your browser. Files are not sent to any server.
    <h2>Hash a File from Your Computer</h2>
    <div id="drop-area">Drop file here, or click to browse</div>
    <p><input type="file" id="fileinput" />
    <h2>Hash a File from Website</h2>
    <p><a href="#" class="tooltip" data-tooltip="Websites which enable Cross Origin Resource Sharing (CORS) can be accessed by this tool. However, most websites do not enable CORS.">Certain websites</a> may allow this tool to retrieve a file directly, without you having to save it to your computer first.
    <form action="" id="uri-form" name="uri-form">
      <p>URL: <input id="uri"></input>
      <input type="submit" value="Submit"></p>
    </form>
    <div id="sha256-hash"></div>
    <div id="errors"></p>
  </body>
</html>
